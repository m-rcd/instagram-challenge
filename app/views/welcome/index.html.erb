<h1>Spacagram</h1>

<p class="navbar-text pull-right">
<% if user_signed_in? %>
  Logged in as <strong><%= current_user.email %></strong>.
  <%= link_to 'Edit profile', edit_user_registration_path, :class => 'navbar-link' %> |
  <%= link_to "Logout", destroy_user_session_path, method: :delete, :class => 'navbar-link'  %>
<% else %>
  <%= link_to "Sign up", new_user_registration_path, :class => 'navbar-link'  %> |
  <%= link_to "Login", new_user_session_path, :class => 'navbar-link'  %>
<% end %>
</p>

<% if user_signed_in? %>
  <%= link_to 'New Post', new_post_path %><br><br>
  <% @posts.each do |post| %>
  <div id='post_<%=post.id %>'>
    <strong><%= link_to post.user.username, profile_path(post.user.username)%></strong><br>
    <%= image_tag(post.image.thumb.url, alt: 'Image') %><br>
    <%= post.description %><br>
    <%= post.created_at.strftime('Posted at %I:%M%p, %d/%m/%Y') %><br>
    <% if post.user_id == current_user.id %>
    <%= link_to 'Edit Post', edit_post_path(post)%>
    <%= link_to 'Delete', post, method: :delete, data: { confirm: 'Are you sure?' } %>
    <%end%>
    <%= post.likes.count %> <%= (post.likes.count) == 1 ? 'Like' : 'Likes'%>
    <%= post.comments.count %> <%= (post.comments.count) == 1 ? 'Comment' : 'Comments'%>
    <% pre_like = post.likes.find { |like| like.user_id == current_user.id} %>
  <% if pre_like %>
    <%= button_to 'Unlike', post_like_path(post, pre_like), method: :delete %>
  <% else %>
    <%= button_to 'Like', post_likes_path(post), method: :post %>
  <% end %>
    <%= link_to 'Add Comment', new_post_comment_path(post.id), method: :get %>

    <% post.comments.each do |comment| %>
    <div id="comment_<%=comment.id %>">
      <strong><%= comment.user.username %></strong>
      <%= comment.body %><br>
      <%= comment.created_at.strftime('Posted at %I:%M%p, %d/%m/%Y') %><br>
    </div>
      <% end%>
    </div>
  <% end %>
<% end %>
